---
// src/components/Experience.astro — Acte 3 : "Storytelling scrollé"
const experiences = [
  {
    id: "cpam92",
    title: "Responsable Département Informatique",
    org: "CPAM des Hauts-de-Seine",
    location: "Nanterre (92)",
    dates: "Depuis Jan. 2026",
    current: true,
    keyFigures: [
      { value: "45", label: "collaborateurs" },
      { value: "1 400", label: "postes de travail" },
      { value: "250+", label: "machines virtuelles" },
    ],
    blocks: [
      {
        type: "scope",
        title: "Périmètre",
        items: [
          "Direction de 3 services : Développement, Support/Infra, Correspondants IT + Data/BI",
          "Pilotage de 30+ applications locales et contribution aux programmes nationaux",
          "Architecture : 40 serveurs physiques, haute disponibilité, monitoring PRTG",
        ],
      },
      {
        type: "achievements",
        title: "Chantiers engagés",
        items: [
          "Structuration de la gouvernance SI : mise en place de la comitologie",
          "Élaboration de la roadmap DSI 2026 du département",
          "Création d'un référentiel applicatif centralisé (cartographie et circuits de validation)",
          "Définition de la stratégie IA du département : gouvernance, cas d'usage métiers et mutualisation inter-organismes",
          "Structuration du Knowledge Management : convergence des bases documentaires et capitalisation des savoirs critiques",
        ],
      },
    ],
  },
  {
    id: "drsm-idf",
    title: "Responsable du service informatique",
    org: "DRSM Île-de-France → CPAM de Paris",
    orgSub: "Cellule de Coordination Régionale IDF",
    location: "Paris (75)",
    dates: "Nov. 2024 — Dec. 2025",
    current: false,

    keyFigures: [
      { value: "24", label: "collaborateurs" },
      { value: "800k€", label: "budget" },
      { value: "81%", label: "résolution N1" },
    ],
    blocks: [
      {
        type: "flagship",
        title: "Fusion régionale DRSM → CPAM : pilotage IT Île-de-France",
        icon: "exchange-alt",
        kpis: [
          { value: "1 155", label: "postes migrés" },
          { value: "8", label: "CPAM coordonnées" },
          { value: "0", label: "interruption de service" },
        ],
        impact: "Pilotage de la migration IT lors de l'absorption de la Direction Régionale du Service Médical par les CPAM : transfert de 1 155 postes de travail, intégration des équipes dans 8 organismes, coordination inter-sites et maintien de la continuité opérationnelle.",
      },
      {
        type: "achievements",
        title: "Knowledge Management & Gouvernance",
        items: [
          "Structuration KM : cartographies 360° (applicatives, infra, compétences) via graphe d'exploration",
          "Catalogue de services ITIL et documentation critique pour sécurisation des opérations",
        ],
      },
      {
        type: "scope",
        title: "Périmètre",
        items: [
          "Management de 24 collaborateurs (support, dev, infra, managers) sur 24 sites",
          "Portefeuille de 40+ applications (Stack Symfony) et 1 300+ postes",
        ],
      },
      {
        type: "achievements",
        title: "Réalisations",
        items: [
          "Gouvernance Stratégique : définition roadmap SI, nouvelle comitologie, qualification des KPI",
          "Performance Support : 8 500 tickets/an, amélioration de 20% des délais moyens de résolution",
        ],
      },
    ],
  },
  {
    id: "cpam16-it",
    title: "Responsable Informatique & Pôle Appui au Pilotage",
    org: "CPAM de la Charente",
    location: "Angoulême (16)",
    dates: "2020 — 2024",
    current: false,
    keyFigures: [
      { value: "10", label: "collaborateurs IT + BI" },
      { value: "40", label: "serveurs" },
    ],
    blocks: [
      {
        type: "flagship",
        title: "Projet phare : DepotDoc (depotdoc.fr)",
        icon: "star",
        kpis: [
          { value: "360k", label: "utilisations/an" },
          { value: "30%", label: "adoption réseau national" },
          { value: "-50%", label: "flux papier" },
        ],
        impact: "Plateforme de dématérialisation. Homogénéisation back-office, amélioration relation client, conduite du changement nationale. Stack Symfony.",
      },
      {
        type: "achievements",
        title: "Modernisation IT & Innovation",
        items: [
          "Stratégie open source (Axelor, GLPI) : réduction coûts licences",
          "Innovation technologique : déploiement IA interne (RAG, BDD Graphe)",
          "Architecture infrastructure : 40 serveurs Linux/Windows, migrations Alma Linux 9",
        ],
      },
      {
        type: "achievements",
        title: "Business Intelligence & Pilotage",
        items: [
          "Outils décisionnels et gouvernance des données métiers",
          "Management de 10 collaborateurs (IT + BI)",
        ],
      },
    ],
  },
  {
    id: "parcours-management",
    dates: "2008 — 2020",
    title: "Parcours Management Opérationnel",
    org: "Protection sociale",
    location: "3 organismes · 12 ans",
    current: false,
    keyFigures: [
      { value: "3", label: "organismes" },
      { value: "12", label: "ans de terrain" },
    ],
    blocks: [
      {
        type: "achievements",
        title: "CPAM Charente — Resp. Agence Cognac (2017–2020)",
        items: [
          "Management de 25 collaborateurs",
          "Pilotage Pôle Régional : mutualisation traitement feuilles de soins (1.3M/an)",
          "Relation client : pilotage courriers et réclamations (16k/an)",
          "Déploiement solution dématérialisée contacts professionnels de santé",
        ],
      },
      {
        type: "achievements",
        title: "CARSAT Centre — Resp. Agences Eure-et-Loir (2015–2017)",
        items: [
          "Management multi-sites 20 collaborateurs (Chartres et Dreux)",
          "Transformation service client : accueil guichet → offre sur rendez-vous",
          "Performance opérationnelle : +10% productivité",
          "Conduite de projets : guide manager structure retraite (adoption 70%)",
        ],
      },
      {
        type: "achievements",
        title: "RSI Poitou-Charentes — Manager Pôle logistique (2008–2015)",
        items: [
          "Management de 5 collaborateurs",
          "Optimisation des processus logistiques et amélioration continue",
        ],
      },
    ],
  },
];
---

<section id="experience" class="relative min-h-screen bg-[#1a2744] overflow-hidden">

  <!-- Header fixe -->
  <div class="absolute top-8 left-6 z-10">
    <h2 class="font-display text-3xl font-bold text-white">
      <span class="font-mono text-teal-400 mr-3">&gt;</span>Expériences
    </h2>
  </div>

  <!-- Hint navigation desktop -->
  <div class="absolute top-20 right-6 z-10 hidden lg:flex items-center gap-2 text-white/40">
    <span class="font-mono text-xs tracking-wider">Scrollez pour naviguer</span>
    <i class="fas fa-arrows-alt-h text-teal-400/60"></i>
  </div>

  <!-- Progress dots -->
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-10 hidden md:flex items-center gap-3">
    {experiences.map((exp, i) => (
      <button class="exp-dot w-2 h-2 rounded-full transition-all bg-white/30" aria-label={exp.org} title={exp.org}></button>
    ))}
  </div>

  <!-- Compteur -->
  <div class="absolute bottom-8 right-6 z-10 font-mono text-xs text-white/30">
    <span class="exp-counter">1</span>/<span>{experiences.length}</span>
  </div>

  <!-- Track horizontal -->
  <div class="exp-panels-track flex h-screen">
    {experiences.map((exp) => (
      <div class="exp-panel flex-none w-screen h-screen flex items-center justify-center overflow-hidden">
        <div class="max-w-5xl w-full px-8 lg:px-12">

          {/* ── EN-TÊTE ── */}
          <div class="mb-5">
            <div class="flex items-center gap-3 mb-3">
              <span class="font-mono text-sm text-teal-400">{exp.dates}</span>
              {exp.current && (
                <span class="px-2 py-0.5 bg-teal-500/20 border border-teal-500/30 rounded text-xs font-mono text-teal-400">En poste</span>
              )}
            </div>
            <h3 class="font-display text-2xl lg:text-3xl font-bold text-white mb-2 leading-tight">{exp.title}</h3>
            <p class="text-white/50 text-lg">{exp.org}</p>
            {exp.orgSub && <p class="text-white/40 text-sm">{exp.orgSub}</p>}
            <p class="text-white/30 text-sm mt-1">{exp.location}</p>
          </div>

          {/* ── NOTE CONTEXTUELLE ── */}
          {exp.note && (
            <p class="text-xs italic text-rose-400/60 mb-5 leading-relaxed max-w-xl">{exp.note}</p>
          )}

          {/* ── CHIFFRES CLÉS — ligne horizontale ── */}
          <div class="flex flex-wrap gap-6 mb-6 pb-5 border-b border-white/5">
            {exp.keyFigures.map(kf => (
              <div class="flex items-baseline gap-2">
                <span class="font-mono text-2xl font-bold text-teal-400">{kf.value}</span>
                <span class="text-xs text-white/40 uppercase tracking-wider">{kf.label}</span>
              </div>
            ))}
          </div>

          {/* ── BLOCS CONTENU ── */}
          {exp.blocks.some(b => b.type === 'flagship') ? (
            /* 2 colonnes si flagship présent */
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="space-y-5">
                {exp.blocks.filter(block => block.type === 'flagship').map(block => (
                  <div class="p-5 bg-white/5 border-l-2 border-teal-400 rounded-r-lg">
                    <h4 class="font-semibold text-sm text-teal-400 mb-4 flex items-center gap-2">
                      <i class={`fas fa-${block.icon}`}></i>
                      {block.title}
                    </h4>
                    <div class="flex flex-wrap gap-6 mb-3">
                      {block.kpis.map(kpi => (
                        <div>
                          <span class="block font-mono text-xl font-bold text-white">{kpi.value}</span>
                          <span class="block text-xs text-white/40">{kpi.label}</span>
                        </div>
                      ))}
                    </div>
                    <p class="text-sm text-white/50 leading-relaxed">{block.impact}</p>
                  </div>
                ))}
              </div>
              <div class="space-y-5">
                {exp.blocks.filter(block => block.type !== 'flagship').map(block => (
                  <div>
                    <h4 class="font-mono text-xs tracking-widest uppercase text-white/30 mb-3">{block.title}</h4>
                    <ul class="space-y-2">
                      {block.items.map(item => (
                        <li class="flex items-start gap-3 text-white/70 text-sm leading-relaxed">
                          <span class="font-mono text-teal-400/60 mt-1 text-xs">&rsaquo;</span>
                          <span>{item}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                ))}
              </div>
            </div>
          ) : (
            /* 1 colonne si pas de flagship */
            <div class="space-y-5">
              {exp.blocks.map(block => (
                <div>
                  <h4 class="font-mono text-xs tracking-widest uppercase text-white/30 mb-3">{block.title}</h4>
                  <ul class="space-y-2">
                    {block.items.map(item => (
                      <li class="flex items-start gap-3 text-white/70 text-sm leading-relaxed">
                        <span class="font-mono text-teal-400/60 mt-1 text-xs">&rsaquo;</span>
                        <span>{item}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
            </div>
          )}

        </div>
      </div>
    ))}
  </div>
</section>
