---
// src/components/Projects.astro — Acte 4 : "Sticky stacking cards"
import { getRepoStats } from '../lib/github';

const orchestrA = await getRepoStats('ElegAlex', 'Orchestr-A');
const opsTracker = await getRepoStats('ElegAlex', 'OPSTRACKER');

const projects = [
  {
    name: "Orchestr-A",
    tagline: "Gestion de projets pour collectivités territoriales",
    description: "Application complète de pilotage de projets et ressources humaines, conçue pour les circuits décisionnels des collectivités. Architecture monorepo moderne avec API REST et interface responsive.",
    stack: ["NestJS", "Next.js", "PostgreSQL", "Redis", "Turborepo", "Docker"],
    github: "https://github.com/ElegAlex/Orchestr-A",
    stats: orchestrA,
    accent: "teal",
    status: "active",
  },
  {
    name: "OPSTRACKER",
    tagline: "Monitoring helpdesk & opérations IT",
    description: "Outil de suivi opérationnel du support informatique : tableaux de bord temps réel, indicateurs de performance helpdesk, analyse volumétrique par site et catégorie.",
    stack: ["Symfony", "PHP", "PostgreSQL", "Redis", "Docker", "Chart.js"],
    github: "https://github.com/ElegAlex/OPSTRACKER",
    stats: opsTracker,
    accent: "amber",
    status: "active",
  },
];
---

<section id="projets" class="py-24 min-h-screen">
  <div class="max-w-4xl mx-auto px-6">

    <h2 class="section-heading font-display text-3xl md:text-4xl font-bold mb-4">
      <span class="font-mono text-teal-500 mr-3">&gt;</span>Projets
    </h2>
    <p class="text-lg opacity-60 mb-16">Applications développées, de l'idée à la production.</p>

    <!-- Sticky stacking cards -->
    <div class="space-y-8">
      {projects.map((project, i) => (
        <div
          class="project-stack-card sticky bg-[var(--color-surface-card)] border border-white/10 rounded-2xl p-8 shadow-xl"
          style={`top: ${100 + i * 40}px;`}
        >
          <div class="flex flex-col sm:flex-row items-start justify-between mb-4 gap-2">
            <div>
              <div class="flex items-center gap-3 mb-2">
                <h3 class="font-display text-2xl font-bold">{project.name}</h3>
                {project.status === 'active' && (
                  <span class="flex items-center gap-1 text-xs font-mono text-green-400">
                    <span class="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></span>
                    Active
                  </span>
                )}
              </div>
              <p class="text-lg opacity-70">{project.tagline}</p>
            </div>
            {project.stats && (
              <div class="flex items-center gap-4 text-sm font-mono opacity-50">
                <span><i class="fas fa-star text-xs"></i> {project.stats.stargazers_count}</span>
                <span><i class="fas fa-code-branch text-xs"></i> {project.stats.forks_count}</span>
              </div>
            )}
          </div>

          <p class="opacity-60 mb-6 max-w-2xl">{project.description}</p>

          <!-- Tech tags -->
          <div class="flex flex-wrap gap-2 mb-6">
            {project.stack.map(tech => (
              <span class={`tech-tag font-mono text-xs px-2.5 py-1 rounded border ${
                project.accent === 'teal'
                  ? 'bg-teal-500/10 border-teal-500/20 text-teal-400'
                  : 'bg-amber-500/10 border-amber-500/20 text-amber-400'
              }`}>{tech}</span>
            ))}
          </div>

          <!-- Links -->
          <div class="flex items-center gap-4">
            <a href={project.github} target="_blank" rel="noopener" class="inline-flex items-center gap-2 text-sm font-mono hover:text-teal-400 transition-colors">
              <i class="fab fa-github"></i> Voir sur GitHub
            </a>
            {project.stats && (
              <span class="text-xs font-mono opacity-30">
                Dernier push : {new Date(project.stats.pushed_at).toLocaleDateString('fr-FR')}
              </span>
            )}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
